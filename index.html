<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KSCCE Assessments Portal — v2.5.0</title>

  <!-- Tailwind (CDN is fine for GitHub Pages) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom-server.browser.development.js"></script>

  <!-- Babel (for in-browser JSX) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Firebase compat (simplest for script-tag apps) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    @media print {
      .screen-only { display:none !important; }
      body { background:#fff !important; }
    }
  </style>
</head>
<body class="bg-slate-100">
  <div id="root" class="screen-only"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    const ReactDOMServer = window.ReactDOMServer;
    const VERSION = "v2.5.0";

    /* ---------------- Firebase (allowlist auth only) ---------------- */
    const FIREBASE_CONFIG = {
      apiKey: "AIzaSyDKSvo5KNuXPq83284_6GOnxXisKA_lSks",
      authDomain: "kssce-51e3e.firebaseapp.com",
      projectId: "kssce-51e3e",
      storageBucket: "kssce-51e3e.appspot.com",
      messagingSenderId: "308291560377",
      appId: "1:308291560377:web:ae634dd42e9ac1459e0c68"
    };
    if (!firebase.apps.length) firebase.initializeApp(FIREBASE_CONFIG);
    const auth = () => firebase.auth();
    const db   = () => firebase.firestore();

    async function isAllowlisted(email){
      if (!email) return false;
      try {
        const key = "allowlist/" + String(email).trim().toLowerCase();
        const snap = await db().doc(key).get();
        return snap.exists;
      } catch (e) {
        console.warn("Allowlist check failed:", e);
        return false;
      }
    }

    /* ---------------- Data (exact wording) ---------------- */
    const YNN = ["Yes","No","N/A"];

    const SECTIONS = [
      { code: "A", title: "General", items: [
        { id:"ic-measures", text:"Hospital should adopt infection control measures." },
        { id:"bmw", text:"Appropriate arrangements for Bio-Medical Waste (BMW) management should be in place." },
        { id:"med-records", text:"Medical Records should be maintained by either in hard or soft copy." },
        { id:"lab-services", text:"Laboratory Services should be available. The same could be dedicated set up or a collection centre with appropriate arrangements for forwarding samples and specimens as well as effective deliverance of results." },
        { id:"birth-death", text:"Birth and death information register should be maintained." },
        { id:"power-backup", text:"Back up facility for electricity failure which covers essential activities should be available." },
        { id:"fire-ext", text:"Fire extinguishers should be available." },
        { id:"linen", text:"Facility for clean/ sterilized linens should be available." },
        { id:"ambulance", text:"Ambulance service arrangement should be in place." },
        { id:"display-services", text:"Display of Services provided and Rates & Packages." },
        { id:"charges-info", text:"Information regarding the services and their approximate charges should be provided by the administration of the hospital." },
      ]},
      { code: "B", title: "OPD", items: [
        { id:"opd-basics", text:"Availability of stethoscope, Torch, Thermometer (Preferably non-mercury), BP Apparatus (Preferably non-mercury), Hand wash facility, Examination table, chairs or stools for the doctor, patient and bystander." },
        { id:"female-attendant", text:"Female attendant for female patients, Privacy to Patients, Information Material for Patients." },
        { id:"registration", text:"Registration of Patients: Name, Age, Sex and contact details (at least mobile number) of the patient should be entered and available in hard or softcopy." },
        { id:"waiting-amenities", text:"Waiting Area, Drinking Water facility and separate male & female toilets should be available." },
        { id:"doc-display", text:"The names of the doctors with their qualifications should be displayed." },
      ]},
      { code: "C", title: "Casualty / Emergency", items: [
        { id:"cas-hr", text:"Human resources supporting the casualty services should be available during the working hours." },
        { id:"cas-drugs-eq", text:"Emergency drugs and equipments should be available according to the scope of the services." },
        { id:"cas-signage", text:"Signage board of the casualty should be displayed at the entrance and be easily visible." },
        { id:"ramp", text:"Patient friendly ramp or slope facility should be available." },
        { id:"stretchers", text:"Stretchers/wheel chairs should be available." },
      ]},
      { code: "D", title: "Inpatient (IPD)", items: [
        { id:"dept-signs", text:"Signboards of different departments and wards should be displayed." },
        { id:"on-call-doc", text:"A doctor should be available on call." },
        { id:"nursing-trained", text:"Personnel trained in nursing for at least 1 year should be available." },
        { id:"beds", text:"Beds should be made available to provide inpatient treatment." },
        { id:"call-system", text:"There should be a system to call the nurses and other attendants (Intercom/Call Bell)." },
        { id:"ipd-basics", text:"Hand Washing Facility/Hand Sanitizer, Bed pan, Waste bins, Attendants Chair/ Stool should be available." },
        { id:"ipd-amenities", text:"Drinking water facility and gender specific toilets should be available." },
      ]},
      { code: "E", title: "OP Cabin Registration Standards", items: [
        { id:"physician-display", text:"Name of the physician with qualification & Registration Number should be displayed." },
        { id:"op-equip", text:"Chairs/ Stool, Examination table, Torch, Thermometer (preferably non- mercurial), BP apparatus (preferably non-mercurial), Stethoscope should be available." },
        { id:"handwash-wait", text:"Hand washing facility, Drinking Water and waiting space should be present." },
      ]},
      { code: "F", title: "Laboratory Registration Standards", items: [
        { id:"lab-consultant", text:"Name of the Consultant with qualification and registration Number displayed." },
        { id:"lab-charges", text:"Display of services & Charges." },
        { id:"lab-equip", text:"Equipments and instruments as per the work load and scope of services." },
      ]},
      { code: "G", title: "Signage", items: [
        { id:"bi-lang", text:"Appropriate signage which shall be in at least two languages (English and Malayalam). A board stating ‘24 hours emergency available’ is desirable." },
        { id:"name-board", text:"Board displaying the name of the hospital at a prominent location." },
        { id:"provider-reg", text:"Name of the care provider with registration number." },
        { id:"reg-details", text:"Registration details of the hospital as applicable as per KCEA 2018." },
        { id:"fee-structure", text:"Availability of fee structure of the various services provided (as per KCEA 2018)." },
        { id:"timings", text:"Timings of the hospital and services provided." },
        { id:"mandatory-info", text:"Mandatory information such as under PNDT Act etc. displayed prominently as applicable." },
        { id:"important-contacts", text:"Important contact numbers such as Blood Banks, Fire Department, Police and Ambulance Services available in the nearby area." },
        { id:"hazard-signs", text:"Safety Hazard and Caution signs, e.g. hazards from electrical shock, inflammable articles, radiation etc. at appropriate places, and as applicable under law." },
        { id:"fire-exit", text:"Appropriate Fire exit signage." },
        { id:"no-smoking", text:"Signage for ‘No Smoking’ at prominent places." },
      ]},
      { code: "H", title: "Infrastructure – Other Requirements", items: [
        { id:"entry", text:"Convenient entry point to the hospital." },
        { id:"pwd", text:"Access within the requirements of ‘Persons with Disabilities Act’ and for all those whose mobility may be restricted due to whatever cause." },
        { id:"hygiene", text:"Safe, clean and hygienic environment for patients, their attendants, staff and visitors." },
        { id:"water-power", text:"24 hour provision of potable water for drinking & hand hygiene, 24 hour supply of electricity, either through direct supply or from other sources like UPS back up, generator facility etc." },
        { id:"public-toilets", text:"Clean public toilet(s) separate for males and females and disabled friendly." },
        { id:"furniture", text:"Furniture and fixtures shall be available in accordance with the activities and workload of the hospital. They shall be functional and properly maintained. Indicative list of furniture and fixtures is as per Annexure 1." },
      ]},
      { code: "I", title: "Infrastructure – Space Requirements", items: [
        { id:"waiting-100", text:"Reception & Waiting area – 100 sq. ft" },
        { id:"consult-80", text:"Consultation cabin with Physical Examination table – 80 sq. ft each" },
        { id:"pharmacy-40", text:"Storage & Pharmacy – 40 sq. ft" },
        { id:"ancillary-60", text:"Ancillary Area – 60 sq. ft" },
        { id:"ward-circ", text:"Circulation space of 30% shall be provided for Nursing station, Ward store, Sanitary etc." },
        { id:"ot-recep", text:"OT (Minor): Reception & Waiting area - 9.2 sq. mt" },
        { id:"ot-consult", text:"OT (Minor): Consultation cabin with Physical Examination table - 7.4 sq. mt each; examination area 3.71 sq. mt" },
        { id:"ot-ancillary", text:"OT (Minor): Storage & Pharmacy / Ancillary Area - 5.57 sq. mt" },
        { id:"ward-areas", text:"The ward shall also have designated areas for nursing station, doctors’ duty room, store, clean and dirty utility, janitor room, toilets and this shall be provided from circulation area." },
        { id:"ward-basin", text:"For a general ward of 20 beds, a minimum of 1 working counter and 1 hand wash basin shall be provided." },
        { id:"bed-gap", text:"Distance between beds shall be 1.0 metres (Desirable)." },
        { id:"head-space", text:"Space at the head end of bed shall be 0.25 metres." },
        { id:"door-corr", text:"Door width shall be 1.2 metres (Desirable) and corridor width 2.5 metres (Desirable)." },
      ]},
      { code: "J", title: "Medical Equipment & Instruments", items: [
        { id:"adequate-equip", text:"Adequate medical equipments and instruments, commensurate to the scope of service and number of beds." },
        { id:"maint-sys", text:"There shall be established system for maintenance of critical equipment." },
        { id:"amc", text:"Equipment shall be kept in good working condition through periodic inspection, cleaning and maintenance (AMC)." },
      ]},
      { code: "K", title: "Drugs, Medical Devices & Consumables", items: [
        { id:"adequate-drugs", text:"Adequate drugs, medical devices and consumables." },
        { id:"emg-drugs", text:"Emergency drugs and consumables shall be available at all times." },
        { id:"drug-storage", text:"Drug storage shall be in a clean, well lit, and safe environment and shall be in consonance with applicable laws and regulations." },
        { id:"inventory", text:"The facility shall have defined procedures for storage, inventory management and dispensing of drugs in pharmacy and patient care areas." },
      ]},
      { code: "L", title: "Human Resources", items: [
        { id:"nursing-hr", text:"Qualified and/or trained nursing staff as per the scope of service provided; nursing care as per professional and regulatory requirements." },
        { id:"paramed-hr", text:"Qualified and/or trained paramedical staff as per the scope of service provided; medical care as per professional and regulatory requirements." },
        { id:"staff-records", text:"For every staff (including contractual staff), there shall be personal record containing appointment order, documentary evidence of qualification and/or training (and professional registration where applicable)." },
        { id:"mbbs-req", text:"Qualified doctor shall be available during the working hours. MBBS Doctor required round the clock only if inpatient services are provided. Advanced primary care: MBBS doctor with post-graduation; Specialized Doctor on call." },
        { id:"nurse-exp", text:"Trained Nurses with ≥1 year experience — at least 1 in a hospital." },
        { id:"pharmacist", text:"Pharmacist (if in-house pharmacy available) — at least 1." },
        { id:"lab-tech", text:"Lab Technician (if in-house laboratory service available) — at least 1." },
        { id:"xray-tech", text:"X-ray Technician (if in-house X-ray facility available) — at least 1." },
        { id:"mts", text:"Multi Task staff — minimum 1." },
      ]},
      { code: "M", title: "Support Services", items: [
        { id:"reg-billing", text:"Have a Registration/ Help-desk & Billing counter." },
        { id:"diag", text:"Diagnostic services may be in-house or outsourced as per minimum standards for diagnostic services." },
        { id:"pharmacy", text:"Pharmacy services available, in-house or outsourced." },
      ]},
      { code: "N", title: "Waste Management Services", items: [
        { id:"general-waste", text:"Segregation, collection, transportation, storage and disposal of general waste as per applicable local laws." },
        { id:"bmw-rules", text:"Segregation, collection, transportation, storage and disposal of biomedical waste as per Bio Medical Waste Handling Rules." },
      ]},
      { code: "O", title: "Legal / Statutory", items: [
        { id:"local-law", text:"Compliance with local regulations and law." },
        { id:"ce-reg", text:"Clinical Establishments Registration (if applicable)." },
        { id:"pcb-bmw", text:"Bio-medical Waste Management Licenses from PCB." },
        { id:"other-lic", text:"Mandatory Licenses from concerned authorities as per the scope of services." },
      ]},
      { code: "P", title: "Records & Reporting", items: [
        { id:"min-records", text:"The minimum medical records to be maintained shall be as per Annexure 4 and as per KCEA 2018." },
        { id:"record-format", text:"Medical Records shall be maintained in physical or digital format." },
        { id:"ipd-records", text:"The medical records of IPD patients shall be maintained in consonance with National or local law, MCI guidelines, and court orders." },
      ]},
    ];

    const ANNEXURES = [
      { code:"Annexure 1", items:[
        "Examination Table","Writing tables","Chairs","Almirah","Waiting Benches","Inpatient Beds","Labour Table- if applicable","Wheel Chair/Stretcher","Medicine Trolley, Instrument Trolley","Screens/curtains","Foot Step","Bed Side Table","Baby Cot- if applicable","Stool","Medicine Chest","Examination Lamp","View box","Fans","Tube Light/ lighting fixtures","Wash Basin","IV Stand","Color coded bins for BMW"
      ].map((x,i)=>({id:"a1-"+i,text:x})) },
      { code:"Annexure 2", items:[
        "Stethoscope","Thermometer Digital","Torch (flash lights)","Sphygmomanometer (B. P. Apparatus) Digital","Weighing Machine Adult/Pediatric","Glucometer","Pulse Oximeter","Syringe & Needles Different size","Examination gloves","Examination table","Otoscope","Patellar hammer","Receptacle for soiled pads, dressings, etc","Sterile equipment storage","Sutures","Thermometer (Non mercury)","Dressing trolley","IV stands","Medicine storage cabinet","Oxygen cylinder","Suction machine","Urinals and bedpans","Linens"
      ].map((x,i)=>({id:"a2-"+i,text:x})) },
      { code:"Annexure 3", items:[
        "INJ. DIAZEPAM 10MG","INJ. FRUSEMIDE 20MG","INJ. ONDANSETRON 8MG/4ML","INJ. RANITIDINE","INJ. NOR ADRENALINE 4MG","INJ. PHENYTOIN 50MG","INJ. DICLOFENAC 75MG","INJ. DERIPHYLLINE","INJ. CHLORPHENIRAMINEMALEATE","INJ. HYDROCORTISONE 100MG","INJ. ATROPINE 0.6MG","INJ. ADRENALINE 1MG","INJ. KCL","STERILE WATER","INJ. SODABICARBONATE","INJ. DOPAMINE","INJ. NALAXONE 400MCG","INJ. LIGNOCAINE 50ML","TAB. SORBITRATE","TAB. ASPIRIN","INJ. TETANUS TOXOID","NEB. SALBUTAMOL 2.5ML","NEB. BUDESONIDE","LIGNOCAINE JELLY 2%","CALCIUM (INJ or TAB)","RL 500ML","NS 500ML","NS 250ML","NS 100ML","DNS 500ML","DEXTROSE 5% 500ML","DEXTROSE 10% 500ML","PEDIATRIC IV INFUSION SOLUTION 500ML"
      ].map((x,i)=>({id:"a3-"+i,text:x})) },
      { code:"Annexure 4", items:[
        "Name & Registration number of treating doctor","Name, demographic details & contact number of patient","Relevant Clinical history, Assessment and re-assessment findings, nursing notes and Diagnosis","Investigation reports","Details of medical treatment, invasive procedures, surgery and other care provided","Applicable consents","Discharge summary","Cause-of-death certificate & Death Summary (where applicable)"
      ].map((x,i)=>({id:"a4-"+i,text:x})) },
    ];

    /* ---------------- Helpers ---------------- */
    const nowStr = () => new Date().toLocaleString();

    /* ---------------- Components ---------------- */
    function HeaderBar({ email, onSignOut, onNew, onFull, onNon, onSave, onLoad }) {
      const pill = "px-3 py-1.5 rounded-full text-sm border flex-shrink-0";
      return (
        <header className="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-slate-200">
          <div className="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
            <div className="w-9 h-9 rounded-xl bg-teal-600 text-white grid place-items-center font-bold">KS</div>
            <div className="grow">
              <div className="font-semibold text-slate-900">KSCCE Assessments Portal</div>
              <div className="text-xs text-slate-500 leading-tight">Logged in as {email}</div>
            </div>

            <!-- Desktop action buttons -->
            <div className="hidden md:flex items-center gap-2">
              <button onClick={onNew} className={`${pill} bg-rose-50 text-rose-700 border-rose-200`}>New Assessment</button>
              <button onClick={onFull} className={`${pill} bg-slate-900 text-white border-slate-900`}>Export Full Report</button>
              <button onClick={onNon} className={`${pill} bg-teal-600 text-white border-teal-600`}>Export Non-Compliances</button>
              <button onClick={onSave} className={`${pill} bg-white text-slate-700 border-slate-200`}>Save As (Local)</button>
              <label className={`${pill} bg-white text-slate-700 border-slate-200 cursor-pointer`}>
                Load from File…
                <input type="file" accept="application/json" onChange={onLoad} className="hidden" />
              </label>
              <button onClick={onSignOut} className="px-3 py-1.5 rounded-full text-sm border bg-white text-slate-700">Sign out</button>
            </div>
          </div>

          <!-- Mobile action pills (scrollable) -->
          <div className="md:hidden border-t border-slate-200 px-3 py-2 bg-white/90 backdrop-blur">
            <div className="overflow-x-auto no-scrollbar whitespace-nowrap">
              <div className="inline-flex gap-2">
                <button onClick={onNew} className={`${pill} bg-rose-50 text-rose-700 border-rose-200`}>New Assessment</button>
                <button onClick={onFull} className={`${pill} bg-slate-900 text-white border-slate-900`}>Export Full Report</button>
                <button onClick={onNon} className={`${pill} bg-teal-600 text-white border-teal-600`}>Export Non-Compliances</button>
                <button onClick={onSave} className={`${pill} bg-white text-slate-700 border-slate-200`}>Save As</button>
                <label className={`${pill} bg-white text-slate-700 border-slate-200 cursor-pointer`}>
                  Load…
                  <input type="file" accept="application/json" onChange={onLoad} className="hidden" />
                </label>
                <button onClick={onSignOut} className={`${pill} bg-white text-slate-700 border-slate-200`}>Sign out</button>
              </div>
            </div>
          </div>
        </header>
      );
    }

    function SectionTabs({ tab, onTab, lastEdited }) {
      const TABS = ["Dashboard","Checklist","Annexure 1","Annexure 2","Annexure 3","Annexure 4"];
      return (
        <>
          <div className="border-b border-slate-200 bg-white/90 backdrop-blur sticky top-[86px] md:top-[60px] z-30">
            <div className="max-w-6xl mx-auto px-3 py-2">
              <div className="overflow-x-auto no-scrollbar whitespace-nowrap">
                <div className="inline-flex gap-2">
                  {TABS.map(t => (
                    <button key={t}
                      onClick={()=>onTab(t)}
                      className={`px-3 py-1.5 rounded-full text-sm border flex-shrink-0 ${tab===t ? "bg-teal-600 text-white border-teal-700" : "bg-white text-slate-700 border-slate-200"}`}>
                      {t}
                    </button>
                  ))}
                </div>
              </div>
            </div>
          </div>
          <div className="max-w-6xl mx-auto px-4 mt-2 text-xs text-slate-500">Last edited: <span className="font-medium text-slate-700">{lastEdited || "-"}</span></div>
        </>
      );
    }

    function HeaderFields({ value, onChange }) {
      return (
        <div className="grid grid-cols-1 md:grid-cols-4 gap-3 bg-white p-4 rounded-2xl border border-slate-200 shadow-sm">
          <div><label className="block text-sm text-slate-600 mb-1">Hospital Name</label>
            <input value={value.hospital||""} onChange={e=>onChange({...value,hospital:e.target.value})} className="w-full rounded-xl border px-3 py-2" placeholder="Hospital name"/></div>
          <div><label className="block text-sm text-slate-600 mb-1">Address</label>
            <input value={value.address||""} onChange={e=>onChange({...value,address:e.target.value})} className="w-full rounded-xl border px-3 py-2" placeholder="Address"/></div>
          <div><label className="block text-sm text-slate-600 mb-1">Date(s) of Visit</label>
            <input value={value.visitDates||""} onChange={e=>onChange({...value,visitDates:e.target.value})} className="w-full rounded-xl border px-3 py-2" placeholder="e.g., 15–16 Sep 2025"/></div>
          <div><label className="block text-sm text-slate-600 mb-1">Assessor Name</label>
            <input value={value.assessor||""} onChange={e=>onChange({...value,assessor:e.target.value})} className="w-full rounded-xl border px-3 py-2" placeholder="Assessor name"/></div>
        </div>
      );
    }

    function SectionCard({ section, state, setState }) {
      return (
        <div className="rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden">
          <div className="px-4 py-2.5 bg-slate-50 border-b border-slate-200">
            <div className="font-semibold text-slate-900">{section.code}. {section.title}</div>
          </div>
          <div className="divide-y">
            {section.items.map((it, idx) => {
              const key = section.code + "-" + it.id;
              const row = state[key] || { v:"", note:"" };
              return (
                <div key={key} className="p-4 grid grid-cols-1 md:grid-cols-12 gap-3 items-start">
                  <div className="md:col-span-7 text-slate-800"><span className="text-slate-400 mr-2">{idx+1}.</span>{it.text}</div>
                  <div className="md:col-span-2">
                    <select value={row.v} onChange={e=>setState(s=>({...s,[key]:{...s[key],v:e.target.value}}))} className="w-full rounded-xl border px-3 py-2">
                      <option value="">Select</option>
                      {YNN.map(x => <option key={x} value={x}>{x}</option>)}
                    </select>
                  </div>
                  <div className="md:col-span-3">
                    <input value={row.note||""} onChange={e=>setState(s=>({...s,[key]:{...s[key],note:e.target.value}}))} placeholder="Notes / remarks" className="w-full rounded-xl border px-3 py-2"/>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      );
    }

    /* ---------------- Dashboard (placeholders, expandable) ---------------- */
    function Expander({ title, children, defaultOpen=false }) {
      const [open, setOpen] = useState(defaultOpen);
      return (
        <div className="rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden">
          <button onClick={()=>setOpen(o=>!o)} className="w-full px-4 py-3 text-left flex items-center justify-between">
            <span className="font-semibold text-slate-900">{title}</span>
            <span className="text-slate-400 text-sm">{open ? "Hide" : "Show"}</span>
          </button>
          {open && <div className="px-4 pb-4">{children}</div>}
        </div>
      );
    }
    function Dashboard({ userEmail }) {
      return (
        <div className="space-y-4">
          <Expander title="Welcome back" defaultOpen>
            <p className="text-sm text-slate-700">You are logged in as <span className="font-medium">{userEmail}</span>. Use “New Assessment” to start a fresh checklist or load a previous file.</p>
          </Expander>
          <Expander title="Upcoming Assessments">
            <p className="text-sm text-slate-500">No assignments yet. (Admin-managed — placeholder)</p>
          </Expander>
          <Expander title="Completed Assessments">
            <p className="text-sm text-slate-500">Your completed items will appear here once we enable cloud sync. (Placeholder)</p>
          </Expander>
          <Expander title="Guidelines">
            <ul className="list-disc pl-5 text-sm text-slate-700 space-y-1">
              <li>Complete all sections and annexures.</li>
              <li>Use “Save As (Local)” frequently while offline.</li>
              <li>Export **Full Report** or **Non-Compliances** from the header.</li>
            </ul>
          </Expander>
          <Expander title="Help & Support">
            <p className="text-sm text-slate-700">For help, contact KSCCE office or your coordinator.</p>
          </Expander>
        </div>
      );
    }

    /* ---------------- Print/Export ---------------- */
    function kscceHeaderHTML(){
      // Extra margin added below (24px) to reduce crowding
      return `
        <div style="text-align:center;font-weight:700">KERALA STATE COUNCIL FOR CLINICAL ESTABLISHMENTS</div>
        <div style="font-size:12px;text-align:center;line-height:1.35;margin-top:4px">
          2nd Floor, Hostel Block of Kerala State Institute of Health and Family Welfare, Thycaud, Thiruvananthapuram -14<br/>
          Phone: 0471-2966523, e-mail: kscce2018@gmail.com<br/>
          Website: www.clinicalestablishments.kerala.gov.in
        </div>
        <div style="height:24px"></div>
      `;
    }
    function openPrint(htmlInner){
      const css = `
        body{font-family:Arial,Helvetica,sans-serif;color:#0f172a;margin:0}
        .wrap{padding:18px 20px}
        table{width:100%;border-collapse:collapse}
        th,td{border:1px solid #cbd5e1;padding:6px 8px;font-size:12px;vertical-align:top}
        thead th{background:#eef2f7}
        h1{margin:0 0 8px 0;font-size:18px}
      `;
      const w = window.open("", "_blank");
      if (!w) { alert("Popup blocked. Allow popups for this site."); return; }
      w.document.open();
      w.document.write(`<!doctype html><html><head><meta charset="utf-8"><title>KSCCE Export</title><style>${css}</style></head><body><div class="wrap">${htmlInner}</div></body></html>`);
      w.document.close();
      setTimeout(()=>{ w.focus(); w.print(); }, 150);
    }
    function buildFullReportHTML(meta, answers){
      let html = kscceHeaderHTML();
      html += `
        <div style="font-weight:700;margin:8px 0 6px">Checklist for Hospital</div>
        <table>
          <tbody>
            <tr><td style="width:30%;font-weight:600">Name & Address of the Hospital:</td><td>${(meta.hospital||"") + (meta.address?.trim()?(", "+meta.address):"")}</td></tr>
            <tr><td style="font-weight:600">Date(s) of Visit:</td><td>${meta.visitDates||""}</td></tr>
          </tbody>
        </table>
      `;
      const blocks = [...SECTIONS, ...ANNEXURES.map(a=>({code:a.code,title:a.code,items:a.items}))];
      for (const s of blocks){
        html += `
          <div style="margin-top:14px;break-inside:avoid">
            <div style="font-weight:600;margin:6px 0">${s.code}. ${s.title}</div>
            <table>
              <thead><tr>
                <th style="width:8%">Sl. No.</th>
                <th>Item</th>
                <th style="width:12%">Answer</th>
                <th style="width:30%">Notes</th>
              </tr></thead>
              <tbody>
        `;
        s.items.forEach((it,i)=>{
          const k = s.code + "-" + (it.id ?? i);
          const r = answers[k] || {};
          html += `<tr><td>${i+1}</td><td>${it.text}</td><td>${r.v||""}</td><td>${r.note||""}</td></tr>`;
        });
        html += `</tbody></table></div>`;
      }
      return html;
    }
    function buildNonCompHTML(meta, answers){
      const rows = [];
      function add(code, title, items){
       